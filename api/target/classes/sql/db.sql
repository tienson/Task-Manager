
DROP DATABASE IF EXISTS `z11_auth`;
CREATE DATABASE `z11_auth` CHARACTER SET utf8 COLLATE utf8_general_ci;

USE `z11_auth`;

-- table
DROP TABLE IF EXISTS `PERMISSION`;
CREATE TABLE IF NOT EXISTS `PERMISSION`(
  `PMSCODE` VARCHAR(50) NOT NULL,
  `PMSDESC` VARCHAR(254),
  PRIMARY KEY(`PMSCODE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- table
DROP TABLE IF EXISTS `ROLE`;
CREATE TABLE IF NOT EXISTS `ROLE`(
  `ROLECODE` VARCHAR(50) NOT NULL,
  `ROLEDESC` VARCHAR(254),
  PRIMARY KEY(`ROLECODE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- table
DROP TABLE IF EXISTS `ROLEPERMISSION`;
CREATE TABLE IF NOT EXISTS `ROLEPERMISSION`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `ROLECODE` VARCHAR(50) NOT NULL,
  `PMSCODE` VARCHAR(254) NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE ROLEPERMISSION ADD CONSTRAINT ROLEPERMISSION_ROLE
FOREIGN KEY (`ROLECODE`)
REFERENCES ROLE(`ROLECODE`)
  ON DELETE CASCADE;

ALTER TABLE ROLEPERMISSION ADD CONSTRAINT ROLEPERMISSION_PERMISSION
FOREIGN KEY (`PMSCODE`)
REFERENCES PERMISSION(`PMSCODE`)
  ON DELETE CASCADE;



-- table
DROP TABLE IF EXISTS `USER`;
CREATE TABLE IF NOT EXISTS `USER`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `USERID` VARCHAR(254) NOT NULL,
  `EMAIL` VARCHAR(254) NOT NULL,
  `NAME` VARCHAR(100) NOT NULL,
  `PHONENUMBER` VARCHAR(254),
  `ADDRESS` VARCHAR(254),
  `PICTURE` VARCHAR(100),
  `PASSWORD` VARCHAR(254) NOT NULL,
  `BALANCE` INT(11) NOT NULL DEFAULT 0,
  `ROLECODE` VARCHAR(50),
  `ACTIVE` BOOLEAN DEFAULT FALSE,	
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE USER ADD CONSTRAINT USER_ROLE
FOREIGN KEY (`ROLECODE`)
REFERENCES ROLE(`ROLECODE`)
  ON DELETE SET NULL;

ALTER TABLE USER ADD INDEX `EMAIL`(`EMAIL`);
ALTER IGNORE TABLE USER ADD UNIQUE (`EMAIL`);
ALTER IGNORE TABLE USER ADD UNIQUE (`USERID`);

-- table
DROP TABLE IF EXISTS `EXTERNALLOGIN`;
CREATE TABLE IF NOT EXISTS `EXTERNALLOGIN`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `LOGINID` VARCHAR(254) NOT NULL,
  `USERID` INT NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE EXTERNALLOGIN ADD CONSTRAINT LOGIN_USER_USER_ID
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;

ALTER TABLE EXTERNALLOGIN ADD INDEX `LOGINID`(`LOGINID`);
ALTER IGNORE TABLE EXTERNALLOGIN ADD UNIQUE (`LOGINID`);

-- table
DROP TABLE IF EXISTS `PAYMENT`;
CREATE TABLE IF NOT EXISTS `PAYMENT`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `USERID` INT NOT NULL,
  `USERID2` INT,
  `AMOUNT` INT NOT NULL, -- neu thanh toan thi la -3, neu nhan dc la 3
  `TYPE` VARCHAR(10) NOT NULL, -- 0:PAY|1:CHARGE|2:BENEFIT|3:CONVERT
  `INFO` VARCHAR(254) NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE PAYMENT ADD CONSTRAINT PAYMENT_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;

ALTER TABLE PAYMENT ADD CONSTRAINT PAYMENT_USER2
FOREIGN KEY (`USERID2`)
REFERENCES USER(`ID`)
  ON DELETE SET NULL;

-- table app
DROP TABLE IF EXISTS `APPLICATION`;
CREATE TABLE IF NOT EXISTS `APPLICATION`(
  `APPCODE` VARCHAR(50) NOT NULL,
  `APPNAME` VARCHAR(200) NOT NULL,
  `APPDESC` TEXT,
  `USERID` INT NOT NULL,
  `LOGBACKURL` VARCHAR(200) DEFAULT NULL,
  `HOMEURL` VARCHAR(200) DEFAULT NULL,
  `TOKENVALUE` VARCHAR(50) NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`APPCODE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE APPLICATION ADD CONSTRAINT APPLICATION_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;

-- table
DROP TABLE IF EXISTS `PRODUCT`;
CREATE TABLE IF NOT EXISTS `PRODUCT`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `PRODUCTCODE` VARCHAR(50) NOT NULL,
  `PRODUCTNAME` VARCHAR(200) NOT NULL,
  `APPCODE` VARCHAR(50) NOT NULL,
  `COST` INT NOT NULL,
  `USERID` INT,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_APPLICATION
FOREIGN KEY (`APPCODE`)
REFERENCES APPLICATION(`APPCODE`)
  ON DELETE CASCADE;

ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE SET NULL;

-- table
DROP TABLE IF EXISTS `PURCHASE`;
CREATE TABLE IF NOT EXISTS `PURCHASE`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `USERID` INT NOT NULL,
  `PRODUCTID` INT NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY Key(`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE PURCHASE ADD CONSTRAINT PURCHASE_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;


ALTER TABLE PURCHASE ADD CONSTRAINT PURCHASE_PRODUCT
FOREIGN KEY (`PRODUCTID`)
REFERENCES PRODUCT(`ID`)
  ON DELETE CASCADE;

-- table userapp
DROP TABLE IF EXISTS `USERAPP`;
CREATE TABLE IF NOT EXISTS `USERAPP`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `USERID` INT NOT NULL,
  `APPCODE` VARCHAR(50) NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE USERAPP ADD CONSTRAINT USERAPP_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;

ALTER TABLE USERAPP ADD CONSTRAINT USERAPP_APP
FOREIGN KEY (`APPCODE`)
REFERENCES APPLICATION(`APPCODE`)
  ON DELETE CASCADE;

-- table userapp
DROP TABLE IF EXISTS `USERCONF`;
CREATE TABLE IF NOT EXISTS `USERCONF`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `USERID` INT NOT NULL,
  `KEY` VARCHAR(20) NOT NULL,
  `VALUE` VARCHAR(200) NOT NULL,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE USERCONF ADD CONSTRAINT USERCONF_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;


DROP TABLE IF EXISTS `DEMOENTIY`;
CREATE TABLE IF NOT EXISTS `DEMOENTIY`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `COLUMNONE` INT NOT NULL,
  `COLUMNTWO` VARCHAR(50) NOT NULL,
  `COLUMNTHREE` TEXT NOT NULL,
  `COLUMNFOUR` VARCHAR(50),
  `COLUMNFIVE` TEXT,
  `COLUMN6` INT,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `VERIFICATION`;
CREATE TABLE IF NOT EXISTS `VERIFICATION`(
  `ID` INT NOT NULL AUTO_INCREMENT,
  `TOKEN` VARCHAR(100) NOT NULL,
  `USERID` INT NOT NULL,
  `CREATEDTIME` DATETIME,
  PRIMARY KEY(`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE VERIFICATION ADD CONSTRAINT VERIFI_USER
FOREIGN KEY (`USERID`)
REFERENCES USER(`ID`)
  ON DELETE CASCADE;


SHOW TABLES;
